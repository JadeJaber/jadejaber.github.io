---
published: true
layout: post
excerpt: description
categories: articles
share: true
tags:
  - linux
  - security
  - certificates
  - architecture theory
---
We are going to discuss in this article about the following concepts :
- Public/Private keys
- Certificates
- SHA algorithms
- RSA algorithms
- SSH
- Signature

> Any comments are welcomed, I'm not an expert, I'm just trying to sum up the why and how of those elements.


## Private & Public keys & asymmetric cryptography
**Definition** : Private and public keys are randomly generated characters. They are used to encrypt and decrypt messages. The privte key is never revealed to anyone whereas the public key may publicly revealed. 

A message encrypted with a private key may only be decrypted with the associated public key and vice versa. This is what we call **asymmetric cryptography**. Which means that only the messages which are encrypted with the public key are "secret" since the ones that are encrypted with the private key may decrypted by anyone who owns the public key which is publicly available.

A public/private key may be generated with such a command  : 
```shell
keytool -genkey -keyalg RSA -alias ssl -keystore keystore.jks -validity 360 -storepass changeit -keypass changeit -dname "cn=hostname, ou=test, o=test, c=XX"
```

**Options definitions** :
- keyalg : ###
- alias : The name of your public/private key pair.
- keystore : The store in which your private/public key pair will securiely saved => It's a safe
- validity : valdity of you public/private key pair
- storepass : password to read/modify/access your keystore
- keypass : Password to access your key pair
- dname : distinguished name associated to your key pair (these info are supposed to identify you as a unique server/person)


## Keystore & Trustore
**Definition** : Keystore & Trustsore are are mainly the same type of element. They are safes which contain private/keys/certificates and which are protected with a password. The keystore contains your public/private keys and certificates whereas the Truststore contains the certificates of the authorities or servers that you trust.

## Asymmetric vs symetric cryptography

**DÃ©finition** : A crypted communication may be done either with a symetric (a unique key) or an asymmetric (2 keys : private & public) cryptorpahy.  

**Pros and cons** : The problem with symetric cryptography is that a secured server who wants to receive encrypted messages (secured web server for instance) will have to generated a different encryption key for each server that need to communicate with it. If all other servers had the same encryption key, then they would all be able to decrypt each othes messages that they each send to the secured server (the secured web server). => This is why we need asymmetric cryptography (AC).

In order to have an AC the secured server need to send its public key to the client. Here comes the man in the middle vulnerability : If the man in the middle catchd the public key of the secured server and sends its own public key to the client, the client would then encrypt its messages with the man in the middle's publick key. The man in the middle would then be able to decrypt the message with its own private key. And then encrypt it again with the secured server public key before sending that message back to the secured server. 

![Man in the middle]({{site.baseurl}}/images/man-in-the-middle.jpg)

We need a solution to garantee to the client (server 3 in the image) that the public key he received is really the one that has been sent by the secured server => This is where certificates gets into the act !

## Certificate 
**Definition** : A certificate is an envelope which contains (among other elements), the public key of the secured server and a "signature". The signature is generated by hashing the whole certificate with all its messages using a hash algorithm (ex : SHA1) ans the result of that hash is called  a digest. The digest is then encrypted with a private key (usually it is a Certificate Authorithy's private key). The encrypted digest is what we call the "signature". Thus, a **certificate** embeds the **public key** and **some identification meta data** concerning the server and the **signature**.

<figure class="half">
	<img src="/images/Certificate_1.gif)" alt="Certificate">
	<img src="/images/certificate_2.gif)" alt="Certificate">
	<figcaption>Certificate</figcaption>
</figure>

**Once the client server receives that certificate, it does 2 things** :
1. It checks if the public key needed to decrypt the signature is in its trustore. In that case, **it means it can trust the incoming message**. The client decrypts the signature and gets ths digest. 
2. The client then generates the digest with the same algorithm used by the secured server and it compares both digests. It they match, the client has the guarantee that the public key embeded in the certificate **has not been altered** and thus can be used to encrypt sensitive data. 

If the man in the middle tried to get into this communication, its certificate would have been rejected from the client since the client does not have the public key of the signatory of the man in the middle's certificate (whether it ia self-signed or signed by CA certificate) 

But symetric cryptography needs less CPU calculation then asymmetric cryptography.

## Signature
**Definition** : A signature is message which has been encrypted using a private or a public key.
 
 ## Tools 
- Open-ssl
- keytool

 
 Link to Cheat sheets